---
import PageLayout from "@layouts/PageLayout.astro";
import {list} from '@vercel/blob';

const assets = await list({
  prefix: 'balzbalz/videos/',
  token: import.meta.env.MICROSITE_FRA_READ_WRITE_TOKEN,
});

const videos = assets.blobs
  .filter(item => !item.pathname.endsWith('/'))
  .map(video => {
    const fileName = video.pathname.split('/').pop() || '';
    let type = null;
    let isPoster = false;
    
    if (fileName.endsWith('.mp4')) {
      type = 'video/mp4';
    } else if (fileName.endsWith('.ogv')) {
      type = 'video/ogg';
    } else if (fileName.includes('poster')) {
      isPoster = true;
    }
    
    return {
      url: video.url,
      name: video.pathname,
      fileName,
      type,
      isPoster,
    };
  });

const posterImage = videos.find(v => v.isPoster);
const videoSources = videos.filter(v => v.type);
---

<PageLayout title="Home">
  <section class="col-[2/-2] lg:col-[5/-5]">
    <h2 class="text-xl pt-4 pb-4 flex justify-center">CAFÉ UND FEINE KOST</h2>
    <div class="spacer w-full h-px bg-white"></div>
    <p class="pt-4 pb-4">
      Wir sind Kathrin und Chris. Geschwister, Gastgeber aus Leidenschaft und
      total versessen auf spitzenmäßigen Kaffee. Unsere Herausforderung ist es,
      euch mit dem Bestmöglichen aus kostbaren Bohnen, außergewöhnlich gut
      belegten Stullen und hausgemachtem Blechkuchen glücklich zu machen. <br />
      <br />
      Schaut vorbei, wir freuen uns auf euch!
    </p>
  </section>
  <section class="pt-4 w-full col-[2/-2] lg:col-[5/-5]">
    <video width="100%" controls poster={posterImage?.url}>
      {videoSources.map(video => (
        <source src={video.url} type={video.type} />
      ))}
    </video>
  </section>
</PageLayout>
